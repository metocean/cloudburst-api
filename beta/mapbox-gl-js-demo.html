<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.15.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.15.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id='map'></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibWV0b2NlYW4iLCJhIjoia1hXZjVfSSJ9.rQPq6XLE0VhVPtcD9Cfw6A';
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/mapbox/light-v8', //stylesheet location
    center: [-74.50, 40], // starting position
    zoom: 3 // starting zoom
});

function main() {

  // Add zoom and rotation controls to the map.
  map.addControl(new mapboxgl.Navigation());

  map.on('style.load', function() {
    map.addSource('msl', {
      type: 'vector',
      // tiles: ["http://localhost:6060/tile/pbf/ncep_mslp_pbf/20160114_12z/0/{z}/{x}/{y}.pbf"]
      tiles: ["http://www.metoceanview.com:6060/tile/pbf/ncep_mslp_pbf/20160114_12z/0/{z}/{x}/{y}.pbf"]
    });
    // normal layer
    map.addLayer({
      "id": "contours",
      "type": "line",
      "source": "msl",
      "source-layer": "ncep_mslp_pbf",
      "filter": ["==", "$type", "LineString"],
      "interactive": true,
      "layout": {
        "line-join": "round",
        "line-cap": "round"
      },
      "paint": {
        "line-color": "#000000",
        "line-width": 1
      }
    });
    map.addLayer({
      "id": "contours-labels",
      "type": "symbol",
      "source": "msl",
      "source-layer": "ncep_mslp_pbf",
      "layout": {
        "symbol-placement": "line",
        "text-field": "{level}",
        "text-size": 10,
        "text-anchor": "bottom",
        "text-padding": 5,
        "text-rotation-alignment": "viewport"
      },
      "paint": {
        "text-color": "red",
        "text-halo-color": "white",
        "text-halo-width": 2
        // "text-halo-blur": 3
      }
    })
    map.addLayer({
      "id": "contours-hover",
      "type": "line",
      "source": "msl",
      "source-layer": "ncep_mslp_pbf",
      "paint": {
        "line-color": "rgba(255,25,0,0.5)",
        "line-width": 4
      },
      "filter": ['all',
        [ '==', 'level', ''] // Start with a filter that doesn't select anything
      ]
    })
  });

  map.on('mousemove', function (e) {
    // query the map for the feature under the mouse
    map.featuresAt(e.point, {
      radius: 20,
      layer: ['contours'],
      includeGeometry: true
    }, function (err, features) {
      if (!err && features.length) {
        // set the filter on the hover style layer to only select the features
        // currently under the mouse
        var ids = features.map(function (feat) {return feat.properties.level })
        map.setFilter('contours-hover', ['all',
            [ 'in', 'level' ].concat(ids)
        ])
      } else {
        map.setFilter('contours-hover', ['==', 'level', '']);
      }
    });
  });
}

if (!mapboxgl.supported()) {
    alert('Your browser does not support Mapbox GL');
} else {
  main();
}


</script>

</body>
</html>
